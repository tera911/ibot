chai = require 'chai'
sinon = require 'sinon'
chai.use require 'sinon-chai'

expect = chai.expect

describe 'google-images', ->
  user =
    name: 'user'
    id: 'U123'
  http =
    query: sinon.stub().returns(@)

  beforeEach ->
    @robot =
      respond: sinon.spy()
      hear: sinon.spy()
    @msg =
      http: sinon.stub().returns(@http)
      send: sinon.spy()
      reply: sinon.spy()
      envelope:
        user:
          @user
      message:
        user:
          @user

    require('../src/google-images')(@robot)

  it 'registers a respond listener', ->
    expect(@robot.respond).to.have.been.called

  it 'registers a hear listener', ->
    expect(@robot.hear).to.not.have.been.called

  it 'responds to "image me kittens"', ->
    @msg.match = [0, 'image', ' me', 'kittens']
    @robot.respond.args[0][1](@msg)
    expect(@msg.send).to.have.been.calledWithMatch(/foo/)
